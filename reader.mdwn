### シーケンス図

#### 乗降リーダとの制御器通信機能
```plantuml
@startuml


actor "乗務員" as p

participant 制御器 as c
participant 乗降リーダ1 as r1
participant 乗降リーダ2 as r2
participant 乗降リーダ3 as r3
participant 乗降リーダ4 as r4


alt 通常
    c-->r1:ステータス通知&要求
    c<--r1:ステータス通知&要求RES

    c-->r2:ステータス通知&要求
    c<--r2:ステータス通知&要求RES

    c-->r3:ステータス通知&要求
    c<--r3:ステータス通知&要求RES

    c-->r4:ステータス通知&要求
    c<--r4:ステータス通知&要求RES

end

alt ①	制御器主局：クライアント(通信異常)\n	乗降RW従局：サーバ								

    c-->r1:xxxxxxxxxxxxxxxxxxx
    note left
        通信異常
        LANケーブルを抜いた場合や
        クライアント側のソケットが閉じられる場合など
        ソケットが使えなくて、ソケットを強制的に破棄する。
    endnote
    

    c-->r2:ステータス通知&要求
    c<--r2:ステータス通知&要求RES

    c-->r3:ステータス通知&要求
    c<--r3:ステータス通知&要求RES

    c-->r4:ステータス通知&要求
    c<--r4:ステータス通知&要求RES


    c-->r1:ステータス通知&要求
    note left
        ピングで接続チェックして、ソケットを初期化する
        復旧
    endnote
    c<--r1:ステータス通知&要求RES


    c-->r2:ステータス通知&要求
    c<--r2:ステータス通知&要求RES

    c-->r3:ステータス通知&要求
    c<--r3:ステータス通知&要求RES

    c-->r4:ステータス通知&要求
    c<--r4:ステータス通知&要求RES
end
note over c,r4:制御対象の全乗降リーダに対して同じ処理を行う

alt ①	制御器主局：サーバ(通信異常)\n	乗降RW従局：クライアント								

    c-->r1:ステータス通知&要求
    c<--r1:xxxxxxxxxxxxxxxxRES
    note left
        通信異常
        接続が切れたときに接続待ちにならずに、ソケットを強制的に破棄する。
    endnote
    

    c-->r2:ステータス通知&要求
    c<--r2:ステータス通知&要求RES

    c-->r3:ステータス通知&要求
    c<--r3:ステータス通知&要求RES

    c-->r4:ステータス通知&要求
    c<--r4:ステータス通知&要求RES


    c-->r1:ステータス通知&要求
    c<--r1:ステータス通知&要求RES
    note left
        ピングで接続チェックして、ソケットを初期化する
        復旧
    endnote


    c-->r2:ステータス通知&要求
    c<--r2:ステータス通知&要求RES

    c-->r3:ステータス通知&要求
    c<--r3:ステータス通知&要求RES

    c-->r4:ステータス通知&要求
    c<--r4:ステータス通知&要求RES
end
note over c,r4:制御対象の全乗降リーダに対して同じ処理を行う

alt QRコード、ICカード時
	c-->r1:ステータス通知&要求
    	c<--r1:ステータス通知&要求RES
	p--->r1:  QRコード、ICカード
	r1--->c:  接客表示&要求
	    note left
        	通信異常
        	接続が切れたときに接続待ちにならずに、ソケットを強制的に破棄する。
    	    endnote
	 c-->r2:ステータス通知&要求
    	 c<--r2:ステータス通知&要求RES

         c-->r3:ステータス通知&要求
         c<--r3:ステータス通知&要求RES

    	 c-->r4:ステータス通知&要求
    	 c<--r4:ステータス通知&要求RES
		
	 c-->r1:ステータス通知&要求
    	 c<--r1:ステータス通知&要求RES
        note left
            ピングで接続チェックして、ソケットを初期化する
            復旧
        endnote
end

@enduml

```
